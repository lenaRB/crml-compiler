# CRML Class-Object Diagram Generator

This project parses CRML files (with the latest CRML grammar) using ANTLR-generated JavaScript parsers and produces **class-object diagrams** in Draw.io (`.drawio`) format.

## Prerequisites

- **Node.js** (any reasonably recent LTS version)
- **npm** (for installing required JS packages, e.g., `antlr4`)
- **ANTLR4 tool** (for regenerating the parser/lexer)
- **VS Code** (optional, for viewing `.drawio` diagrams)
- **Draw.io Integration** extension in VS Code (to open/edit the generated `.drawio` files)

## Setup

1. **Install Node dependencies**  
   From the project root, ensure you have the runtime dependencies installed. For example, if you have a `package.json`, run:
   ```bash
   npm install
   ```
   Make sure the `antlr4` JavaScript runtime is available (e.g., via `npm install antlr4` if not already).

2. **Generate ANTLR JavaScript files**  
   Whenever you modify the grammar (`crml.g4` and `modelica.g4`), regenerate the ANTLR parser/lexer like this:
   ```bash
   antlr4 -Dlanguage=JavaScript crml.g4 modelica.g4 -o antlr
   ```
   > **Note:** If your grammar includes a header that emits `package grammar;` in the generated JS, you may need to remove or adjust that because it is not valid in the Node.js ES module context.

## Usage

The canonical diagram generator for the current grammar is:

```bash
node instanceDiagramGeneratorLatest.js <path-to-crml-file>
```

**Example:**
```bash
node instanceDiagramGeneratorLatest.js test_files_latest_crml/pumping3.crml
```

This will produce a Draw.io class-object diagram file alongside the input, e.g.:

```
test_files_latest_crml/pumping3_class_object2.drawio
```

## Viewing the Diagram

To view and edit the generated `.drawio` file:

1. Install **Visual Studio Code** if you haven’t already.
2. Install the **Draw.io Integration** extension in VS Code.
3. Open the `.drawio` file generated by the script directly in VS Code via the extension.

## Project Structure & Caveats

- The project is **JavaScript-based**. Everything depends on having the proper Node environment and required packages (e.g., `antlr4`).
- Besides `instanceDiagramGeneratorLatest.js`, the repository contains several other folders and older diagram generators targeting previous versions of the grammar. Those are **likely broken** with the current grammar and may emit errors if used as-is.
- Only `instanceDiagramGeneratorLatest.js` is expected to work out of the box with the **latest CRML grammar-compliant files**. Other generators are kept for reference and will be updated in the future.

## Troubleshooting

- **Syntax errors or “package grammar;” issues in generated ANTLR JS**: Remove any `package` declarations emitted by grammar headers (e.g., from `@header { ... }`) or adjust the grammar so the generated JS is valid for Node ES modules.
- **Missing `antlr4` module**: Install it via:
  ```bash
  npm install antlr4
  ```
- **Diagram not showing all instances**: Ensure your CRML input is grammar-compliant. Nested or complex instantiations rely on the parser correctly recognizing them per the current grammar.

## Future Work

- Update and fix other legacy diagram generators in their respective folders to support the new grammar.
- Improve grammar coverage to reduce parse-time errors and better support initializer constructs.
